header:
  version: 14
  includes:
    - base-image.yml

machine: raspberrypi4-64
distro: poky

target:
  - xensiv-bgt60trxx-test-image

repos:
  poky:
    url: https://git.yoctoproject.org/poky
    refspec: kirkstone
    layers:
      base: meta
      yocto: meta-yocto
      bsp: meta-yocto-bsp

  meta-openembedded:
    url: https://git.openembedded.org/meta-openembedded
    refspec: kirkstone
    layers:
      oe: meta-oe
      python: meta-python
      networking: meta-networking

  meta-raspberrypi:
    url: https://git.yoctoproject.org/meta-raspberrypi
    refspec: kirkstone

  xensiv-bgt60trxx:
    url: .
    layers:
      xensiv: meta-xensiv-bgt60trxx

local_conf_header:
  raspberrypi: |
    # Raspberry Pi specific configuration
    ENABLE_SPI = "1"
    ENABLE_I2C = "1"
    ENABLE_UART = "1"
    
    # GPU memory split
    GPU_MEM = "128"
    
    # Enable device tree overlays
    ENABLE_DTC = "1"
    
    # Add SPI and GPIO support
    KERNEL_DEVICETREE:append = " overlays/spi0-1cs.dtbo overlays/spi1-1cs.dtbo"
    
    # Add XENSIV BGT60TRxx library to image
    IMAGE_INSTALL:append = " xensiv-bgt60trxx xensiv-bgt60trxx-examples"
    
    # Add development packages
    IMAGE_INSTALL:append = " xensiv-bgt60trxx-dev"
    
    # Add useful tools for testing
    IMAGE_INSTALL:append = " spitools i2c-tools gpio-utils"
    
    # Enable package management
    EXTRA_IMAGE_FEATURES += "package-management debug-tweaks"